---
import Footer from '@components/Footer.astro'
import Header from '@components/Header.astro'
import '@styles/global.css'

interface Props {
  title: string
}
const { title } = Astro.props

const localBusinessSchema = {
	"@context": "https://schema.org",
	"@type": "LocalBusiness",
	"name": "Odontología Especializada Dr. Alexander Ojalvo",
	"image": "/images/logo.webp",
	"description": "Servicio de odontología especializada con técnicas de vanguardia",
	"address": {
		"@type": "PostalAddress",
		"streetAddress": "Av. 16 de Julio y D'orbigny, Zona Capacachi",
		"addressLocality": "Cochabamba",
		"addressRegion": "Cochabamba",
		"postalCode": "",
		"addressCountry": "BO"
	},
	"priceRange": "$$$",
	"areaServed": "Cochabamba",
	"serviceType": "Dental Care",
	"openingHoursSpecification": {
		"@type": "OpeningHoursSpecification",
		"dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
		"opens": "08:00",
		"closes": "16:00"
	},
	"sameAs": [
		"https://www.facebook.com/dralejanderoojalvo"
	],
	"geo": {
		"@type": "GeoCoordinates",
		"latitude": -17.383329,
		"longitude": -66.221854
	}
};

const dentistSchema = {
	"@context": "https://schema.org",
	"@type": "Dentist",
	"name": "Dr. Alexander Ojalvo",
	"image": "/images/profile.webp",
	"description": "Especialista en odontología con años de experiencia",
	"knowsAbout": ["General Dentistry", "Dental Implants", "Orthodontics", "Cosmetic Dentistry", "Endodontics"],
	"url": "https://dralejanderoojalvo.com/"
};
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<title>{title}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="Odontología especializada en Cochabamba. Servicios dentales de vanguardia: implantes, ortodoncia, diseño de sonrisa. Dr. Alexander Ojalvo - tu salud bucal es nuestra prioridad." />
		<meta name="keywords" content="odontología Cochabamba, dentista especializado, implantes dentales, ortodoncia, diseño de sonrisa, blanqueamiento dental" />
		<meta name="author" content="Dr. Alexander Ojalvo" />
		<meta name="robots" content="index, follow" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://dralejanderoojalvo.com/" />
		<meta property="og:title" content={title} />
		<meta property="og:description" content="Odontología especializada en Cochabamba. Servicios dentales de vanguardia con Dr. Alexander Ojalvo." />
		<meta property="og:image" content="/og-image.webp" />
		<meta property="og:locale" content="es_ES" />
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content="Odontología especializada en Cochabamba. Servicios dentales de vanguardia con Dr. Alexander Ojalvo." />
		<meta name="twitter:image" content="/og-image.webp" />
		
		<!-- Local Business Schema -->
		<script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />
		
		<!-- Dentist Professional Schema -->
		<script type="application/ld+json" set:html={JSON.stringify(dentistSchema)} />
		
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="canonical" href="https://dralejanderoojalvo.com/" />
	</head>
	<body>
    <Header />
		<main class="flex flex-col">
      <slot/>
    </main>
    <div id="cmpContainer"></div>
    <Footer/>
    <script>
      // Simple intersection observer for reveal animations
      const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      };
      
      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('active');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);
      
      function initAnimations() {
        const hiddenElements = document.querySelectorAll('.reveal');
        hiddenElements.forEach((el) => observer.observe(el));
      }
      
      // Initialize on load
      window.addEventListener('load', initAnimations);
      document.addEventListener('astro:page-load', initAnimations);

      // Update JSON-LD schemas with phone number when available
      async function updateSchemaWithPhoneNumber() {
        try {
          const apiUrl = import.meta.env.PUBLIC_API_URL || '';
          if (!apiUrl) return;
          
          const response = await fetch(`${apiUrl}/appointment-requests/doctor-phoneNumber`);
          if (!response.ok) return;
          
          const phoneNumber = await response.text();
          if (!phoneNumber) return;

          // Update LocalBusiness schema
          const localBusinessScript = document.querySelector('script[type="application/ld+json"]:nth-of-type(1)');
          if (localBusinessScript) {
            const schema = JSON.parse(localBusinessScript.textContent);
            schema.telephone = `+591 ${phoneNumber}`;
            localBusinessScript.textContent = JSON.stringify(schema);
          }

          // Update Dentist schema
          const dentistScript = document.querySelector('script[type="application/ld+json"]:nth-of-type(2)');
          if (dentistScript) {
            const schema = JSON.parse(dentistScript.textContent);
            schema.telephone = `+591 ${phoneNumber}`;
            dentistScript.textContent = JSON.stringify(schema);
          }
        } catch (error) {
          console.error('Failed to update schemas with phone number:', error);
        }
      }

      // Run after page load
      window.addEventListener('load', updateSchemaWithPhoneNumber);
    </script>
	</body>
</html>